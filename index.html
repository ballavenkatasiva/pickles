<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bujji Pickles</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ======= GLOBAL STYLE ======= */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #101820;
  color: #fff;
}
.container {
  max-width: 400px;
  margin: 40px auto;
  background: #1c2733;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 0 25px rgba(0,0,0,0.4);
}
h2 {
  margin-top: 0;
  text-align: center;
}

input, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}
input {
  background: #28394a;
  color: #fff;
}
button {
  background: #ff9a3c;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}
button:hover { background: #ffb469; }

.msg {
  margin-top: 10px;
  color: #ffd7b5;
  text-align: center;
}

.link {
  margin-top: 10px;
  text-align: center;
  color: #9ab3c9;
  cursor: pointer;
}

/* Dashboard */
#dashboard {
  display: none;
  max-width: 700px;
  margin: 30px auto;
}
.table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
.table th, .table td {
  padding: 10px;
  border-bottom: 1px solid #445566;
}
.table th {
  background: #233040;
}
.delete-btn {
  background: #ff4d4d;
  color: white;
  padding: 6px;
  border-radius: 5px;
  cursor: pointer;
}

</style>
</head>
<body>

<!-- LOGIN / REGISTER -->
<div id="auth" class="container">
  <h2 id="form-title">Login</h2>

  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">

  <button id="action-btn">Login</button>

  <div id="msg" class="msg"></div>

  <div class="link" id="toggle-form">Create new account?</div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <h2 id="dash-title" style="text-align:center;">Welcome ❤️</h2>

  <!-- Admin Summary -->
  <div id="admin-summary" style="display:none;text-align:center;margin-top:10px;font-size:18px;">
    <b>Total Bookings: <span id="total-book-count">0</span></b>
  </div>

  <div class="container">
    <h3>Create Booking</h3>
    <input id="bname" placeholder="Customer Name">
    <input id="bitem" placeholder="Item (Mango Pickle)">
    <input id="bqty" type="number" placeholder="Qty">
    <input id="bphone" placeholder="Phone Number">
    <button id="book-btn">Save Booking</button>
    <div id="book-msg" class="msg"></div>
  </div>

  <div class="container" style="margin-top:20px;">
    <h3>All Bookings</h3>
    <table class="table" id="bookings-table">
      <thead>
        <tr>
          <th>#</th><th>Name</th><th>Item</th><th>Qty</th><th>Phone</th><th>Date</th><th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <button onclick="logout()" style="width:200px;margin:20px auto;display:block;background:#ff5252;color:#fff;">
    Logout
  </button>
</div>

<script>
/* ===== API URL ===== */
const api = "https://pickles-wn7g.onrender.com";

let isAdmin = false;

/* ===== LOGIN / REGISTER TOGGLE ===== */
let mode = "login";
const title = document.getElementById("form-title");
const btn = document.getElementById("action-btn");
const toggle = document.getElementById("toggle-form");
const msg = document.getElementById("msg");

toggle.onclick = () => {
  msg.innerHTML = "";
  if (mode === "login") {
    mode = "register";
    title.innerText = "Register";
    btn.innerText = "Create Account";
    toggle.innerText = "Already have account? Login";
  } else {
    mode = "login";
    title.innerText = "Login";
    btn.innerText = "Login";
    toggle.innerText = "Create new account?";
  }
};

/* ===== LOGIN / REGISTER ACTION ===== */
btn.onclick = async () => {
  msg.innerHTML = "";
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();

  if (!u || !p) { msg.innerHTML = "Enter username & password"; return; }

  const url = api + (mode === "login" ? "/login" : "/register");
  const res = await fetch(url, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({username:u, password:p})
  });
  const data = await res.json();

  if (data.success) {
    if (mode === "login") {
      document.getElementById("auth").style.display = "none";
      document.getElementById("dashboard").style.display = "block";

      isAdmin = data.admin === true;

      if (isAdmin) {
        document.getElementById("dash-title").innerText = "Admin Dashboard ❤️";
        document.getElementById("admin-summary").style.display = "block";
      } else {
        document.getElementById("dash-title").innerText = "Welcome Bujji ❤️";
        document.getElementById("admin-summary").style.display = "none";
      }

      loadBookings();
    } else {
      msg.style.color = "lightgreen";
      msg.innerHTML = "Account created. Please login.";
      mode = "login";
      title.innerText = "Login";
      btn.innerText = "Login";
      toggle.innerText = "Create new account?";
    }
  } else {
    msg.innerHTML = data.message || "Error";
  }
};

/* ===== CREATE BOOKING ===== */
document.getElementById("book-btn").onclick = async () => {
  const b = {
    name: document.getElementById("bname").value.trim(),
    item: document.getElementById("bitem").value.trim(),
    qty: document.getElementById("bqty").value.trim(),
    phone: document.getElementById("bphone").value.trim(),
    date: new Date().toLocaleString()
  };

  if (!b.name || !b.item || !b.phone) {
    document.getElementById("book-msg").innerHTML = "Fill all required fields.";
    return;
  }

  const res = await fetch(api + "/book", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(b)
  });

  const data = await res.json();

  if (data.success) {
    document.getElementById("book-msg").style.color = "lightgreen";
    document.getElementById("book-msg").innerHTML = "Booking Saved!";
    loadBookings();
  }
};

/* ===== LOAD BOOKINGS ===== */
async function loadBookings() {
  const res = await fetch(api + "/bookings");
  const list = await res.json();

  const tb = document.querySelector("#bookings-table tbody");
  tb.innerHTML = "";

  list.forEach((b, i) => {
    tb.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td>${b.name}</td>
        <td>${b.item}</td>
        <td>${b.qty}</td>
        <td>${b.phone}</td>
        <td>${b.date}</td>
        <td>${isAdmin ? `<button class='delete-btn' onclick='deleteBooking(${i})'>Delete</button>` : ''}</td>
      </tr>
    `;
  });

  document.getElementById("total-book-count").innerText = list.length;
}

/* ===== DELETE BOOKING (ADMIN ONLY) ===== */
async function deleteBooking(id) {
  await fetch(api + "/booking/" + id, { method: "DELETE" });
  loadBookings();
}

/* ===== LOGOUT ===== */
function logout() {
  location.reload();
}
</script>

</body>
</html>
